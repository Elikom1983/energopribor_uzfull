{% extends 'base.html' %}
{% load static %}
{% block link %}
<link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="checkout-container">
    <h2>Rasmiylashtirish</h2>

    <!-- ðŸ”¹ enctype multipart - fayl yuklash uchun kerak -->
    <form method="POST" action="{% url 'store:checkout' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="checkout-grid">

        <!-- Chap qism -->
        <div class="checkout-left">
          <div class="form-group">
            <label>Ismingiz</label>
            <input type="text" name="full_name" placeholder="Ismingizni kiriting" required>
          </div>

          <div class="form-group">
            <label>Telefon raqamingiz</label>
            <input type="text" name="phone" placeholder="+998 XX XXX XX XX" required>
          </div>

          <div class="form-group">
            <label>Manzilingiz</label>
            <input type="text" name="address" placeholder="Viloyat, tuman, koâ€˜cha" required>
          </div>

          <div class="form-group">
            <label>Yetkazib berish turi</label>
            <select name="delivery_type">
              <option value="kuryer">Kuryer orqali</option>
              <option value="olib ketish">Oâ€˜zim olib ketaman</option>
            </select>
          </div>

          <div class="form-group">
            <label>Qoâ€˜shimcha izoh (ixtiyoriy)</label>
            <textarea name="comment" rows="3" placeholder="Izoh..."></textarea>
          </div>
        </div>

        <!-- Oâ€˜ng qism -->
        <div class="checkout-right">
          <div class="summary-box">
            <h4>Buyurtma maâ€™lumotlari</h4>
            <ul>
              {% for item in cart_items %}
              <li>
                <span>{{ item.product.product_name }} Ã— {{ item.quantity }}</span>
                <span>{{ item.total_price|floatformat:0 }} soâ€˜m</span>
              </li>
              {% endfor %}
            </ul>
            <hr>
            <p class="total">Jami: <span>{{ cart_total|floatformat:0 }} soâ€˜m</span></p>
          </div>

          <!-- Toâ€˜lov usuli -->
          <div class="payment-method">
            <h4>Toâ€˜lov usuli</h4>
            <label>
              <input type="radio" name="payment_method" value="naqd" checked> Naqd toâ€˜lov
            </label><br>
            <label>
              <input type="radio" name="payment_method" value="online"> Online (Payme/Click)
            </label><br>
            <label>
              <input type="radio" name="payment_method" value="transfer"> Pul oâ€˜tkazish (bank orqali)
            </label>
          </div>

          <!-- ðŸ”¹ Faqat transfer boâ€˜lsa koâ€˜rinadigan maydonlar -->
          <div id="transfer-fields" style="display:none; margin-top:20px;">
            <div class="form-group">
              <label>Pul oâ€˜tkazilgan summa (soâ€˜mda)</label>
              <input type="number" step="0.01" name="transfer_amount" placeholder="Masalan: 250000.00">
            </div>
            <div class="form-group">
              <label>Oâ€˜tkazma cheki (rasm yuklang)</label>
              <input type="file" name="transfer_receipt" accept="image/*">
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Buyurtmani yuborish</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- ðŸ”¹ Script: faqat transfer tanlanganda inputlar chiqadi -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const radios = document.querySelectorAll('input[name="payment_method"]');
  const transferFields = document.getElementById('transfer-fields');

  radios.forEach(radio => {
    radio.addEventListener('change', function() {
      if (this.value === 'transfer') {
        transferFields.style.display = 'block';
      } else {
        transferFields.style.display = 'none';
      }
    });
  });
});
</script>

<style>
.checkout-container {
  background: #fff;
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  margin: 30px 0;
}
.checkout-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 30px;
}
.form-group { margin-bottom: 20px; }
.form-group label {
  font-weight: 600;
  margin-bottom: 6px;
  display: block;
}
.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  font-size: 15px;
}
.summary-box {
  background: #f9f9f9;
  padding: 20px;
  border-radius: 12px;
}
.summary-box h4 { margin-bottom: 10px; }
.summary-box ul { list-style: none; padding: 0; margin: 0; }
.summary-box li {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}
.summary-box .total {
  font-weight: 700;
  font-size: 18px;
}
.payment-method { margin-top: 20px; }
.payment-method h4 { margin-bottom: 10px; }
.btn-primary {
  background: #1C70D0;
  color: white;
  border: none;
  padding: 12px 20px;
  width: 100%;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}
.btn-primary:hover { background: #145aad; }
</style>
{% endblock %}
